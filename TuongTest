extends CharacterBody3D

func _ready():
	add_to_group("DongMinh")
	input_ray_pickable = true # Bắt buộc phải bật cái này
	rotation_degrees.y = 0

func di_chuyen_den(vi_tri_dich):
	# Cộng thêm 0.2m để đứng LÊN TRÊN mặt ô (dù là bàn cờ hay hàng chờ)
	var dich_den_chuan = vi_tri_dich + Vector3(0, 1.2, 0)
	
	# Bay lên cao để né cạnh bàn cờ
	var do_cao_bay = max(global_position.y, dich_den_chuan.y) + 2.0
	
	var tween = create_tween()
	var p_cao = Vector3(global_position.x, do_cao_bay, global_position.z)
	var p_dich_cao = Vector3(dich_den_chuan.x, do_cao_bay, dich_den_chuan.z)
	
	tween.tween_property(self, "global_position", p_cao, 0.15)
	tween.tween_property(self, "global_position", p_dich_cao, 0.25)
	tween.tween_property(self, "global_position", dich_den_chuan, 0.2).set_trans(Tween.TRANS_BOUNCE)

func _input_event(camera, event, position, normal, shape_idx):
	if event is InputEventMouseButton and event.button_index == MOUSE_BUTTON_LEFT and event.pressed:
		# Tìm GameManager và báo cáo
		var gm = get_tree().root.get_node_or_null("GameManager")
		if gm: gm.chon_tuong(self)
